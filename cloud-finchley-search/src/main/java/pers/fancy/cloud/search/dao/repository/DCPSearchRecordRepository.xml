<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="pers.fancy.cloud.search.dao.repository.DCPSearchRecordRepository">

    <sql id="insertSql">
      (FD_ID,FD_SEARCH_WORD,FD_USER_NAME,FD_USER_ID,FD_SEARCH_TIME)
    </sql>

    <resultMap id="recordList" type="pers.fancy.cloud.search.model.dto.SearchRecordDto">
      <result column="FD_SEARCH_WORD" property="fdWord"/>
    </resultMap>

    <insert id="addRecord" parameterType="pers.fancy.cloud.search.model.entity.SearchRecordEntity">
      insert into SEARCH_LOG_WORD
      <include refid="insertSql"/>
      values
      (#{fdId},#{fdWord},#{fdUserName},#{fdUserId},#{fdSearchTime})
    </insert>

    <select id="findHotRecord" parameterType="java.util.Map" resultMap="recordList">
      SELECT FD_SEARCH_WORD, COUNT(FD_SEARCH_WORD) AS count
      FROM SEARCH_LOG_WORD
      <where>
          <if test="params.startTime != null and params.startTime != ''">
              FD_SEARCH_TIME > #{params.startTime}
          </if>
          <if test="params.endTime != null and params.endTime != ''">
             and FD_SEARCH_TIME  &lt;= #{params.endTime}
          </if>
      </where>
      GROUP BY FD_SEARCH_WORD
      ORDER BY COUNT desc
      limit 0, 5
    </select>

    <delete id="deleteRecordById" parameterType="string">
      delete from SEARCH_LOG_WORD where id = #{id}
    </delete>

</mapper>